require 'rails_helper'

RSpec.feature "Episode Alteration", type: :feature do

  # Yes, these are the same specs as episode creation
  # What do you mean 'shared examples'?

  background do
    Episode.new(name: 'Old Episode').save!(validate: false)
    visit '/episodes'
    click_on 'Edit'
  end

  scenario 'A user updates an episode' do
    fill_in 'Other', with: 'The Joy of Painting'
    fill_in 'Name', with: 'Alpine View'
    fill_in 'Happy little trees', with: '10'
    check 'Cabin?'
    fill_in 'Mountain', with: '2'
    fill_in 'Critters', with: '2'
    click_on 'Update Episode'

    expect(page).to have_content 'Episode was successfully updated.'
    expect(page).to have_content 'Alpine View The Joy of Painting'
    expect(page).to have_content '🌲 🌲 🏡 🌲 🌲 🌲 🌲 🌲 🌲 🌲 🌲'
    expect(page.html).to match $MOUNTAIN_HTML
    expect(page).to have_css('.critter-background', count: 2)
  end

  scenario 'A user submits an invalid mountain percentage' do
    fill_in 'Mountain', with: '-4'
    click_on 'Update Episode'
    expect(page).to have_content 'Mountain % must be a percentage'
  end

  scenario 'A user submits an invalid episode' do
    fill_in 'Critters', with: '5'
    click_on 'Update Episode'
    expect(page).to have_content 'Series must exist'
    expect(page).to have_content "Critters must be less than 4"
  end

  scenario 'A user submits a duplicate episode' do
    Episode.new(name: 'Episode 1').save!(validate: false)
    fill_in 'Name', with: 'Episode 1'
    click_on 'Update Episode'
    expect(page).to have_content "Name has already been taken"
  end

  scenario 'A user submits a lonely critter' do
    fill_in 'Critters', with: '1'
    click_on 'Update Episode'
    expect(page).to have_content "Critters gotta have friends. Like I always say, everyone needs a friend."
  end

  scenario 'A user chooses an existing series' do
    Series.new(name: 'Oils and You').save!(validate: false)
    visit current_path
    choose 'Oils and You'
    fill_in 'Name', with: 'Alpine View'
    click_on 'Update Episode'
    expect(page).to have_content 'Alpine View Oils and You'
  end

end

$MOUNTAIN_HTML = <<-HTML
<span style="color: #86a9e9;"></span><span style="color: #87a9e8;">#</span><span style="color: #89aaf1;">#</span><span style="color: #8baafc;">#</span><span style="color: #8dabff;">#</span><span style="color: #8dacfe;">#</span><span style="color: #8dadfa;">#</span><span style="color: #93b2ff;">#</span><span style="color: #93b2ff;">#</span><span style="color: #90afff;">#</span><span style="color: #94b3ff;">#</span><span style="color: #94b3ff;">#</span><span style="color: #93b2ff;">#</span><span style="color: #93b2ff;">#</span><span style="color: #93b2ff;">#</span><span style="color: #95b4ff;">#</span><span style="color: #95b4ff;">#</span><span style="color: #9ab6ff;">#</span><span style="color: #9ab7fb;">#</span><span style="color: #9ab7fb;">#</span><span style="color: #9fbcff;">#</span><span style="color: #9fbcff;">#</span><span style="color: #9fbcfe;">#</span><span style="color: #9eb8f5;">#</span><span style="color: #a0baf7;">#</span><span style="color: #a3bdfa;">#</span><span style="color: #a5bffc;">#</span><span style="color: #a7c1fe;">#</span><span style="color: #a2bdff;">#</span><span style="color: #a4bfff;">#</span><span style="color: #a5c0ff;">#</span><span style="color: #a4bfff;">#</span><span style="color: #a2bdff;">#</span><span style="color: #a2beff;">#</span><span style="color: #a1bdfc;">#</span><span style="color: #a0bcfb;">#</span><span style="color: #a2befd;">#</span><span style="color: #a5c1ff;">#</span><span style="color: #a1befa;">#</span><span style="color: #aac3fb;">#</span><span style="color: #a8c1f9;">#</span><span style="color: #acc5fd;">#</span><span style="color: #aac3fb;">#</span><span style="color: #aec7ff;">#</span><span style="color: #bac6f8;">#</span><span style="color: #bac6f8;">#</span><span style="color: #bac6f8;">#</span><span style="color: #b9c5f7;">#</span><span style="color: #b7c3f5;">#</span><span style="color: #b3c4f2;">#</span><span style="color: #b2c5f0;">#</span><span style="color: #b2c5f0;">#</span><span style="color: #b2c5f0;">#</span><span style="color: #b2c5f0;">#</span><span style="color: #b3c5ed;">#</span><span style="color: #bcc7e7;">#</span><span style="color: #bfc8e7;">#</span><span style="color: #c7cce9;">#</span><span style="color: #c8cce5;">#</span><span style="color: #cbcbe3;">#</span><span style="color: #bfccdf;">#</span><span style="color: #b6c4de;">#</span><span style="color: #afbde0;">#</span><span style="color: #adbee9;">#</span><span style="color: #acbeee;">#</span><span style="color: #aec3ee;">#</span><span style="color: #b0c3ed;">#</span><span style="color: #b3c2e9;">#</span><span style="color: #b6c4e7;">#</span><span style="color: #b9c3e6;">#</span><span style="color: #b9c4e4;">#</span><span style="color: #bbc1e1;">#</span><span style="color: #bdc3e3;">#</span><span style="color: #bcc2e2;">#</span><span style="color: #bec4e4;">#</span><span style="color: #c0c6e6;">#</span><span style="color: #c7c6e6;">#</span><span style="color: #c4c7ea;">#</span><span style="color: #c0c8ed;">#</span><span style="color: #bac5f2;">#</span><span style="color: #bccdf9;">#</span><span style="color: #adccff;">#</span><span style="color: #a5c9ff;">#</span><span style="color: #a0c4ff;">#</span><span style="color: #a3c7ff;">#</span><span style="color: #a3c7ff;">#</span><span style="color: #a9cbff;">#</span><span style="color: #aec7ff;">#</span><span style="color: #aec8ff;">#</span><span style="color: #acc6ff;">#</span><span style="color: #b6d1ff;">#</span><span style="color: #afcbfd;">#</span><span style="color: #c2c1eb;">#</span><span style="color: #c2c1eb;">#</span><span style="color: #c2c1eb;">#</span><span style="color: #c5c4ee;">#</span><span style="color: #c5c4ee;">#</span><span style="color: #b3bff1;">#</span><span style="color: #b2c1f8;">#</span><span style="color: #b2c5ff;">#</span><span style="color: #abc1fb;">#</span><span style="color: #aac2ff;">#</span><span style="color: #a8c4ff;">#</span><span style="color: #9fc2ff;">#</span><span style="color: #9dc2ff;">#</span><span style="color: #96beff;">#</span><span style="color: #94bfff;">#</span><span style="color: #93c0ff;">#</span><span style="color: #92c2ff;">#</span><span style="color: #8fbfff;">#</span><span style="color: #93c3ff;">#</span><span style="color: #8fbfff;">#</span><span style="color: #8fbfff;">#</span><span style="color: #94bdff;">#</span><span style="color: #95bcff;">#</span><span style="color: #95bcff;">#</span><span style="color: #97beff;">#</span><span style="color: #97beff;">#</span><span style="color: #97beff;">#</span><span style="color: #97beff;">#</span><span style="color: #97beff;">#</span><span style="color: #97beff;">#</span><span style="color: #97beff;">#</span><span style="color: #97beff;">#</span><span style="color: #97bffd;">#</span><span style="color: #97bffd;">#</span><span style="color: #97bffd;">#</span><span style="color: #9ac2ff;">#</span><span style="color: #9cc4ff;">#</span><span style="color: #a1c4fe;">#</span><span style="color: #a3c3fc;">#</span><span style="color: #a3c3fc;">#</span><span style="color: #a7c7ff;">#</span><span style="color: #a7c7ff;">#</span><span style="color: #a7c8fe;">#</span><span style="color: #aac8fe;">#</span><span style="color: #accaff;">#</span><span style="color: #afcdff;">#</span><span style="color: #afcdff;">#</span><span style="color: #afcdff;">#</span><span style="color: #afcefc;">#</span><span style="color: #b1d0fe;">#</span><span style="color: #b3d2ff;">#</span><span style="color: #b3d2ff;">#</span><span style="color: #b3d2ff;">#</span><span style="color: #b4cffe;">#</span><span style="color: #b6d1ff;">#</span><span style="color: #b8d3ff;">#</span><span style="color: #b6d1ff;">#</span><span style="color: #b6d1ff;">#</span><span style="color: #b5d1ff;">#</span><span style="color: #b1cfff;">#</span><span style="color: #b1cfff;">#</span><span style="color: #b1cfff;">#</span><span style="color: #b1cfff;">#</span><span style="color: #b1cfff;">#</span><span style="color: #b0ceff;">#</span><span style="color: #b3d1ff;">#</span><span style="color: #afcdff;">#</span><span style="color: #accafc;">#</span><span style="color: #a6c4f6;">#
</span><span style="color: #81a8eb;">#</span><span style="color: #83a9f2;">#</span><span style="color: #85a9ff;">#</span><span style="color: #87abff;">#</span><span style="color: #87abff;">#</span><span style="color: #88abfc;">#</span><span style="color: #8babfe;">#</span><span style="color: #8babfe;">#</span><span style="color: #8babfe;">#</span><span style="color: #90b0ff;">#</span><span style="color: #90b0ff;">#</span><span style="color: #8fb0ff;">#</span><span style="color: #8fb0ff;">#</span><span style="color: #8fb0ff;">#</span><span style="color: #91b2ff;">#</span><span style="color: #91b2ff;">#</span><span style="color: #94b5fc;">#</span><span style="color: #96b4fa;">#</span><span style="color: #96b4fa;">#</span><span style="color: #94b2f8;">#</span><span style="color: #94b2f8;">#</span><span style="color: #94b3f6;">#</span><span style="color: #9ab6f5;">#</span><span style="color: #9cb8f7;">#</span><span style="color: #9cb8f7;">#</span><span style="color: #9ebaf9;">#</span><span style="color: #a0bcfb;">#</span><span style="color: #9eb9fc;">#</span><span style="color: #a0bbfe;">#</span><span style="color: #a2bdff;">#</span><span style="color: #a1bcff;">#</span><span style="color: #9fbafd;">#</span><span style="color: #9bb7f8;">#</span><span style="color: #9cb8f7;">#</span><span style="color: #9db9f8;">#</span><span style="color: #a1bdfc;">#</span><span style="color: #a3bffe;">#</span><span style="color: #a0bdf9;">#</span><span style="color: #a7c0f8;">#</span><span style="color: #a4bdf5;">#</span><span style="color: #a9c2fa;">#</span><span style="color: #a7c0f8;">#</span><span style="color: #abc4fc;">#</span><span style="color: #b7c3f5;">#</span><span style="color: #b7c3f5;">#</span><span style="color: #b7c3f5;">#</span><span style="color: #b7c3f5;">#</span><span style="color: #b5c1f3;">#</span><span style="color: #b1c2f0;">#</span><span style="color: #b0c3ee;">#</span><span style="color: #b0c3ee;">#</span><span style="color: #b0c3ee;">#</span><span style="color: #b0c3ee;">#</span><span style="color: #b1c2ed;">#</span><span style="color: #b9c3e6;">#</span><span style="color: #bbc6e6;">#</span><span style="color: #c4c9e7;">#</span><span style="color: #c5c9e4;">#</span><span style="color: #c7c8e4;">#</span><span style="color: #bdc9e1;">#</span><span style="color: #b6c4e1;">#</span><span style="color: #b2c0e3;">#</span><span style="color: #afc0eb;">#</span><span style="color: #aec0f0;">#</span><span style="color: #aec3ee;">#</span><span style="color: #b0c3ed;">#</span><span style="color: #b3c2e9;">#</span><span style="color: #b4c2e5;">#</span><span style="color: #b7c1e4;">#</span><span style="color: #b7c2e2;">#</span><span style="color: #bbc1e1;">#</span><span style="color: #bdc3e3;">#</span><span style="color: #bcc2e2;">#</span><span style="color: #bec4e4;">#</span><span style="color: #c0c6e6;">#</span><span style="color: #c6c7e6;">#</span><span style="color: #c4c7ea;">#</span><span style="color: #c2c8ec;">#</span><span style="color: #bfc8f1;">#</span><span style="color: #b9c6f0;">#</span><span style="color: #b2cafa;">#</span><span style="color: #aec8f9;">#</span><span style="color: #acc6f9;">#</span><span style="color: #a8c2f3;">#</span><span style="color: #a8c2f5;">#</span><span style="color: #afc6fa;">#</span><span style="color: #b7c6fd;">#</span><span style="color: #b6c7fb;">#</span><span style="color: #b2c2f5;">#</span><span style="color: #b6c9f4;">#</span><span style="color: #b4c5f1;">#</span><span style="color: #c4c4e6;">#</span><span style="color: #c4c4e6;">#</span><span style="color: #c4c4e6;">#</span><span style="color: #c6c6e8;">#</span><span style="color: #c6c6e8;">#</span><span style="color: #b8c4ee;">#</span><span style="color: #b6c4f1;">#</span><span style="color: #b5c6f4;">#</span><span style="color: #afc3f5;">#</span><span style="color: #acc3f5;">#</span><span style="color: #a8c3fa;">#</span><span style="color: #a2c1ff;">#</span><span style="color: #9fc2ff;">#</span><span style="color: #9ac0ff;">#</span><span style="color: #98c0ff;">#</span><span style="color: #96c1ff;">#</span><span style="color: #94c1ff;">#</span><span style="color: #91beff;">#</span><span style="color: #95c2ff;">#</span><span style="color: #93c0ff;">#</span><span style="color: #93c0ff;">#</span><span style="color: #94bdff;">#</span><span style="color: #95bcff;">#</span><span style="color: #95bcff;">#</span><span style="color: #95bcff;">#</span><span style="color: #95bcff;">#</span><span style="color: #95bcff;">#</span><span style="color: #95bcff;">#</span><span style="color: #95bcff;">#</span><span style="color: #97beff;">#</span><span style="color: #97beff;">#</span><span style="color: #97beff;">#</span><span style="color: #97bffd;">#</span><span style="color: #97bffd;">#</span><span style="color: #97bffd;">#</span><span style="color: #9ac2ff;">#</span><span style="color: #9cc4ff;">#</span><span style="color: #a1c4fe;">#</span><span style="color: #a3c3fc;">#</span><span style="color: #a3c3fc;">#</span><span style="color: #a7c7ff;">#</span><span style="color: #a7c7ff;">#</span><span style="color: #a7c8fe;">#</span><span style="color: #aac8fe;">#</span><span style="color: #accaff;">#</span><span style="color: #afcdff;">#</span><span style="color: #afcdff;">#</span><span style="color: #afcdff;">#</span><span style="color: #afcefc;">#</span><span style="color: #b1d0fe;">#</span><span style="color: #b3d2ff;">#</span><span style="color: #b3d2ff;">#</span><span style="color: #b3d2ff;">#</span><span style="color: #b4cffe;">#</span><span style="color: #b6d1ff;">#</span><span style="color: #b8d3ff;">#</span><span style="color: #b6d1ff;">#</span><span style="color: #b6d1ff;">#</span><span style="color: #b5d1ff;">#</span><span style="color: #b1cfff;">#</span><span style="color: #b1cfff;">#</span><span style="color: #b1cfff;">#</span><span style="color: #b1cfff;">#</span><span style="color: #b1cfff;">#</span><span style="color: #b0ceff;">#</span><span style="color: #b3d1ff;">#</span><span style="color: #afcdff;">#</span><span style="color: #abc9fb;">#</span><span style="color: #a4c2f4;">#
HTML
